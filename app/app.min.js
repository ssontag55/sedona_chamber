function startup(){function e(e){Q=[e],$("#search-select-list").find(".select-item").each(function(){e.indexOf($(this).data("value"))>-1?($(this).data("selected",!0),$(this).attr("data-selected",!0)):($(this).data("selected",!1),$(this).attr("data-selected",!1))}),o.removeLayer(that.spacespts),o.removeLayer(b),o.removeLayer(B),o.removeLayer(y),o.removeLayer(g),o.removeLayer(G),o.removeLayer(P),o.removeLayer(E),o.removeLayer(that.parkingpts),o.removeLayer(S),o.removeLayer(N),o.removeLayer(V),o.removeLayer(_),o.removeLayer(I),o.removeLayer(s),o.removeLayer(Y)}function t(e,t){e.removeClass("open"),t?(e.addClass("open"),e.children(".select-item").find(".parent-icon").removeClass("glyphicon-plus").addClass("glyphicon-minus"),e.children("ul.children").each(function(e){this.style.maxHeight=this.scrollHeight+"px"})):(e.children(".select-item").find(".parent-icon").addClass("glyphicon-plus").removeClass("glyphicon-minus"),e.children("ul.children").each(function(e){this.style.maxHeight=null}))}function a(e,a,O){e.siblings(".children").length>0&&t(e.parent("li"),!0),that.points=L.geoJson();var H=!1;if(e.data("selected",O),e.attr("data-selected",O),a.search("retail-")>-1){if(!O&&a.split("-")[1]){for(var R=that.retailCategories.length-1;R>=0;R--)that.retailCategories[R]===a.split("-")[1]&&that.retailCategories.splice(R,1);r.setFilter(function(e){return that.retailCategories.indexOf(e.properties.subcat)>-1})}o.removeLayer(r),r.addTo(o)}if(a.search("what2do-")>-1){if(!O&&a.split("-")[1]){if("recreation"==a.split("-")[1])for(var Z=that.what2doCategoriesRec.length-1;Z>=0;Z--)that.what2doCategories.splice(that.what2doCategories.indexOf(that.what2doCategoriesRec[Z]),1);else if("entertainment"==a.split("-")[1])for(var D=that.what2doCategoriesEntert.length-1;D>=0;D--)that.what2doCategories.splice(that.what2doCategories.indexOf(that.what2doCategoriesEntert[D]),1);z.setFilter(function(e){return that.what2doCategories.indexOf(e.properties.subcat)>-1})}o.removeLayer(z),z.addTo(o)}O?(Q.push(a),"air"==a?(i.addTo(o),processLayer2Geo(i),addMouseClickListener(i)):"spiritual"==a?(d.addTo(o),processLayer2Geo(d),addMouseClickListener(d)):"trans"==a?(J.addTo(o),processLayer2Geo(J),addMouseClickListener(J)):a.search("what2do")>-1?a.split("-")[1]&&("recreation"==a.split("-")[1]?that.what2doCategories=that.what2doCategories.concat(that.what2doCategoriesRec):"entertainment"==a.split("-")[1]&&(that.what2doCategories=that.what2doCategories.concat(that.what2doCategoriesEntert)),z.setFilter(function(e){return that.what2doCategories.indexOf(e.properties.subcat)>-1}),o.removeLayer(z),z.addTo(o),addMouseClickListener(z)):"church"==a?(f.addTo(o),processLayer2Geo(f),addMouseClickListener(f)):"astronomy"==a?(n.addTo(o),processLayer2Geo(n),addMouseClickListener(n)):"bikesegway"==a?(bikesegwaypts.addTo(o),processLayer2Geo(bikesegwaypts),addMouseClickListener(bikesegwaypts)):"ground"==a?(c.addTo(o),processLayer2Geo(c),addMouseClickListener(c)):"private"==a?(p.addTo(o),processLayer2Geo(p),addMouseClickListener(p)):"jeeptrolley"==a?(l.addTo(o),processLayer2Geo(l),addMouseClickListener(l)):"specialty"==a?(u.addTo(o),processLayer2Geo(u),addMouseClickListener(u)):"wine"==a?(h.addTo(o),processLayer2Geo(h),addMouseClickListener(h)):"gallery"==a?(B.addTo(o),processLayer2Geo(B),addMouseClickListener(B)):"rest"==a?(processLayer2Geo(G),G.addTo(o),addMouseClickListener(G)):"theatre"==a?(P.addTo(o),processLayer2Geo(P),addMouseClickListener(P)):"museum"==a?(E.addTo(o),processLayer2Geo(E),addMouseClickListener(E)):"parking"==a?(that.parkingpts.addTo(o),that.loader.className="",addRealTimeParking(!0),addMouseClickListener(that.parkingpts)):"parks"==a?(S.addTo(o),addMouseClickListener(S)):"lodge"==a?(j.addTo(o),addMouseClickListener(j)):"water"==a?(y.addTo(o),addMouseClickListener(y)):"bike"==a?(g.addTo(o),addMouseClickListener(g)):"pubart"==a?(N.addTo(o),processLayer2Geo(N),addMouseClickListener(N),H=!0):"recycling"==a?(V.addTo(o),processLayer2Geo(V),addMouseClickListener(V)):"bus"==a?(_.addTo(o),addMouseClickListener(_)):"toilets"==a?(b.addTo(o),addMouseClickListener(b)):"walk"==a?(I.addTo(o),addMouseClickListener(I)):"traffic"==a?Y.addTo(o):"wedding"==a?s.addTo(o):"ev"==a?m.addTo(o):"stargazing7"==a?(M.addTo(o),addMouseClickListener(M)):"vistas7"==a?(T.addTo(o),addMouseClickListener(T)):"picnics7"==a?(C.addTo(o),addMouseClickListener(C)):"arts7"==a?(x.addTo(o),addMouseClickListener(x)):"spiritual7"==a?(v.addTo(o),addMouseClickListener(v)):"biking7"==a?(w.addTo(o),addMouseClickListener(w)):"hiking7"==a?(k.addTo(o),addMouseClickListener(k)):a.search("retail-")>-1&&a.split("-")[1]&&(that.retailCategories.push(a.split("-")[1]),r.setFilter(function(e){return that.retailCategories.indexOf(e.properties.subcat)>-1}),o.removeLayer(r),r.addTo(o),addMouseClickListener(r))):(Q=Q.filter(function(e){return e!==a}),o.removeLayer(that.spacespts),"toilets"===a&&o.removeLayer(b),"gallery"===a&&o.removeLayer(B),"wedding"===a&&o.removeLayer(s),"rest"===a&&o.removeLayer(G),"theatre"===a&&o.removeLayer(P),"museum"===a&&o.removeLayer(E),"parking"===a&&o.removeLayer(that.parkingpts),"parks"===a&&o.removeLayer(S),"lodge"===a&&o.removeLayer(j),"church"===a&&o.removeLayer(f),"water"===a&&o.removeLayer(y),"bike"===a&&o.removeLayer(g),"pubart"===a&&o.removeLayer(N),"recycling"===a&&o.removeLayer(V),"bus"===a&&o.removeLayer(_),"walk"===a&&o.removeLayer(I),"traffic"===a&&o.removeLayer(Y),"air"===a&&o.removeLayer(i),"astronomy"===a&&o.removeLayer(n),"bikesegway"===a&&o.removeLayer(bikesegwaypts),"ground"===a&&o.removeLayer(c),"private"===a&&o.removeLayer(p),"jeeptrolley"===a&&o.removeLayer(l),"specialty"===a&&o.removeLayer(u),"wine"===a&&o.removeLayer(h),"ev"===a&&o.removeLayer(m),"spiritual"===a&&o.removeLayer(d),"trans"===a&&o.removeLayer(J),"hiking7"===a&&o.removeLayer(k),"biking7"===a&&o.removeLayer(w),"spiritual7"===a&&o.removeLayer(v),"arts7"===a&&o.removeLayer(x),"picnics7"===a&&o.removeLayer(C),"vistas7"===a&&o.removeLayer(T),"stargazing7"===a&&o.removeLayer(M)),1==H?"mobile"==that.browsertype?$("#pubartCarouselmobile").show():$("#pubartCarousel").show():($("#pubartCarousel").hide(),$("#pubartCarouselmobile").hide())}if(that=this,that.gotoloc=[],that.loader=document.getElementById("loader"),that.points=L.geoJson(),that.token="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",L.mapbox.accessToken="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",that.browsertype="desktop",bowser.android||bowser.ios||bowser.mobile){var o=L.mapbox.map("map",null,{zoomControl:!1}).setView([34.86394,-111.76486],14);that.browsertype="mobile",L.control.zoom({position:"topright"}).addTo(o),o.addControl(new L.mapbox.shareControl({position:"topright"})),o.on("popupopen",function(e){var t=o.project(e.popup._latlng);t.y-=e.popup._container.clientHeight/2-100,o.panTo(o.unproject(t),{animate:!0})}),L.control.zoom({position:"topright"}).addTo(o),o.addControl(new L.mapbox.shareControl({position:"topright"})),that.timedelay=1e3}else var o=L.mapbox.map("map",null,{zoomControl:!1}).setView([34.86394,-111.76486],14);that.map=o,that.retailCategories=[],that.what2doCategories=[],that.what2doCategoriesEntert=["370","376","432","334","372","141","142","373","374","144"],that.what2doCategoriesRec=["219","446","221","448","431","449","222","451","450","447","355","220"];var r=L.mapbox.featureLayer("data/retail.json",{popupOptions:{closeButton:!0}}),s=L.mapbox.featureLayer("data/weddings.json",{popupOptions:{closeButton:!0}}),i=L.mapbox.featureLayer("data/tours-air.json",{popupOptions:{closeButton:!0}}),n=L.mapbox.featureLayer("data/tours-astronomy.json",{popupOptions:{closeButton:!0}}),d=L.mapbox.featureLayer("data/spiritual.json",{popupOptions:{closeButton:!0}}),c=L.mapbox.featureLayer("data/tours-ground.json",{popupOptions:{closeButton:!0}}),p=L.mapbox.featureLayer("data/tours-guides.json",{popupOptions:{closeButton:!0}}),l=L.mapbox.featureLayer("data/tours-jeeptrolley.json",{popupOptions:{closeButton:!0}}),u=L.mapbox.featureLayer("data/tours-specialty.json",{popupOptions:{closeButton:!0}}),h=L.mapbox.featureLayer("data/tours-wine.json",{popupOptions:{closeButton:!0}}),m=L.mapbox.featureLayer("data/ev.json",{popupOptions:{closeButton:!0}}),y=L.mapbox.featureLayer("data/water.json",{popupOptions:{closeButton:!0}}),g=L.mapbox.featureLayer("data/bike.json",{popupOptions:{closeButton:!0}}),f=L.mapbox.featureLayer("data/churches.json",{popupOptions:{closeButton:!0}}),b=L.mapbox.featureLayer("data/restrooms.json",{popupOptions:{closeButton:!0}}),k=L.mapbox.featureLayer("data/hiking7.json",{popupOptions:{closeButton:!0}}),w=L.mapbox.featureLayer("data/biking7.json",{popupOptions:{closeButton:!0}}),v=L.mapbox.featureLayer("data/spiritual7.json",{popupOptions:{closeButton:!0}}),x=L.mapbox.featureLayer("data/artculture7.json",{popupOptions:{closeButton:!0}}),C=L.mapbox.featureLayer("data/picnics7.json",{popupOptions:{closeButton:!0}}),T=L.mapbox.featureLayer("data/vistas7.json",{popupOptions:{closeButton:!0}}),M=L.mapbox.featureLayer("data/stargazing7.json",{popupOptions:{closeButton:!0}}),O=L.mapbox.featureLayer("data/basefeatures.json",{popupOptions:{closeButton:!0}}),j=L.mapbox.featureLayer("data/hotels.json",{popupOptions:{closeButton:!0}}),G=L.mapbox.featureLayer("data/restaurant.json",{popupOptions:{closeButton:!0}}),B=L.mapbox.featureLayer("data/gallery.json",{popupOptions:{closeButton:!0}}),_=L.mapbox.featureLayer("data/bus.json",{popupOptions:{closeButton:!0}}),P=L.mapbox.featureLayer("data/theatre.json",{popupOptions:{closeButton:!0}});that.parkingpts=L.mapbox.featureLayer("data/parking.json",{popupOptions:{closeButton:!0,settings:"parking"}});var I=L.mapbox.featureLayer("data/walking.json",{popupOptions:{closeButton:!0}}),E=L.mapbox.featureLayer("data/museum.json",{popupOptions:{closeButton:!0}}),N=L.mapbox.featureLayer("data/publicart.json",{popupOptions:{closeButton:!0}}),V=L.mapbox.featureLayer("data/recycling.json",{popupOptions:{closeButton:!0}}),S=L.mapbox.featureLayer("data/parks.json",{popupOptions:{closeButton:!0}});that.spacespts=L.mapbox.featureLayer("data/spaces.json",{popupOptions:{closeButton:!0}});var J=L.mapbox.featureLayer("data/trans.json",{popupOptions:{closeButton:!0}}),z=L.mapbox.featureLayer("data/what2do.json",{popupOptions:{closeButton:!0}}),Y=L.mapbox.styleLayer("mapbox://styles/sedonachamber/cj0d9x1vd00012rlbjrrj7ciu",{maxZoom:20,zIndex:1e3});O.addTo(o),addMouseClickListener(O),b.on("ready",processLayerGeo),r.on("ready",processLayerGeo),i.on("ready",processLayerGeo),y.on("ready",processLayerGeo),g.on("ready",processLayerGeo),n.on("ready",processLayerGeo),s.on("ready",processLayerGeo),c.on("ready",processLayerGeo),p.on("ready",processLayerGeo),l.on("ready",processLayerGeo),u.on("ready",processLayerGeo),h.on("ready",processLayerGeo),m.on("ready",processLayerGeo),j.on("ready",processLayerGeo),G.on("ready",processLayerGeo),P.on("ready",processLayerGeo),that.parkingpts.on("ready",processLayerGeo),E.on("ready",processLayerGeo),f.on("ready",processLayerGeo),B.on("ready",processLayerGeo),P.on("ready",processLayerGeo),_.on("ready",processLayerGeo),N.on("ready",processLayerGeo),S.on("ready",processLayerGeo),J.on("ready",processLayerGeo),z.on("ready",processLayerGeo),k.on("ready",processLayerGeo),w.on("ready",processLayerGeo),v.on("ready",processLayerGeo),x.on("ready",processLayerGeo),C.on("ready",processLayerGeo),T.on("ready",processLayerGeo),M.on("ready",processLayerGeo),window.location.href.indexOf("tours")>-1?(e(["tours","air","astronomy","bikesegway","ground","private","jeeptrolley","specialty","wine","water","bike","church"]),i.addTo(o),n.addTo(o),s.addTo(o),c.addTo(o),y.addTo(o),p.addTo(o),l.addTo(o),u.addTo(o),h.addTo(o),addMouseClickListener(i),addMouseClickListener(n),addMouseClickListener(s),addMouseClickListener(c),addMouseClickListener(p),addMouseClickListener(l),addMouseClickListener(u),addMouseClickListener(h),addMouseClickListener(y)):window.location.href.toLowerCase().indexOf("/secret7")>-1?(e(["secret7","hiking7","biking7","vistas7","spiritual7","picnics7","arts7","stargazing7"]),k.addTo(o),w.addTo(o),v.addTo(o),x.addTo(o),C.addTo(o),T.addTo(o),M.addTo(o),addMouseClickListener(k),addMouseClickListener(w),addMouseClickListener(v),addMouseClickListener(x),addMouseClickListener(C),addMouseClickListener(T),addMouseClickListener(M),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("hiking7")>-1?(e(["hiking7"]),k.addTo(o),addMouseClickListener(k),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("biking7")>-1?(e(["biking7"]),w.addTo(o),addMouseClickListener(w),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("vistas7")>-1?(e(["vistas7"]),T.addTo(o),addMouseClickListener(T),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("picnics7")>-1?(e(["picnics7"]),C.addTo(o),addMouseClickListener(C),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("stargazing7")>-1?(e(["stargazing7"]),M.addTo(o),addMouseClickListener(M),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("spiritual7")>-1?(e(["spiritual7"]),v.addTo(o),addMouseClickListener(v),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("arts7")>-1?(e(["arts7"]),x.addTo(o),addMouseClickListener(x),o.setView([34.86394,-111.76486],11)):window.location.href.toLowerCase().indexOf("secret7map")>-1?(e(["secret7","hiking7","biking7","vistas7","spiritual7","picnics7","arts7","stargazing7"]),k.addTo(o),w.addTo(o),v.addTo(o),x.addTo(o),C.addTo(o),T.addTo(o),M.addTo(o),addMouseClickListener(k),addMouseClickListener(w),addMouseClickListener(v),addMouseClickListener(x),addMouseClickListener(C),addMouseClickListener(T),addMouseClickListener(M),o.setView([34.86394,-111.76486],11)):window.location.href.indexOf("restrooms")>-1?(e(["toilets"]),b.addTo(o),addMouseClickListener(b),o.setView([34.86394,-111.76486],16)):window.location.href.indexOf("restaurants")>-1?(e(["rest"]),G.addTo(o),addMouseClickListener(G)):window.location.href.indexOf("bike")>-1?(e(["bike","water"]),g.addTo(o),y.addTo(o),addMouseClickListener(g),addMouseClickListener(y),o.setView([34.86394,-111.76486],13)):window.location.href.indexOf("churches")>-1?(e(["churches"]),f.addTo(o),addMouseClickListener(f)):window.location.href.indexOf("lodging")>-1?(e(["lodge"]),j.addTo(o),addMouseClickListener(j)):window.location.href.indexOf("green")>-1?(e(["recycling"]),V.addTo(o),addMouseClickListener(V)):window.location.href.indexOf("parks")>-1?(e(["parks","water"]),S.addTo(o),y.addTo(o),addMouseClickListener(y),addMouseClickListener(S)):window.location.href.indexOf("trails")>-1?(e(["parks","water"]),S.addTo(o),y.addTo(o),g.addTo(o),addMouseClickListener(g),addMouseClickListener(y),addMouseClickListener(S)):window.location.href.indexOf("parking")>-1?(e(["parking","ev"]),that.parkingpts.addTo(o),m.addTo(o),addMouseClickListener(m),addRealTimeParking(!0),setInterval(addRealTimeParking,5e4)):window.location.href.indexOf("publicart")>-1?(e(["pubart"]),N.addTo(o),addMouseClickListener(N),"mobile"==that.browsertype?$("#pubartCarouselmobile").show():$("#pubartCarousel").show()):window.location.href.indexOf("art")>-1?(e(["gallery","bus","walk","museum","theatre"]),P.addTo(o),E.addTo(o),that.parkingpts.addTo(o),_.addTo(o),B.addTo(o),I.addTo(o),addMouseClickListener(B)):window.location.href.indexOf("galleries")>-1?(e(["gallery","bus","walk","museum","theatre"]),P.addTo(o),E.addTo(o),B.addTo(o),_.addTo(o),I.addTo(o),addMouseClickListener(B)):window.location.href.indexOf("traffic")>-1?(e(["bus","parking","traffic"]),Y.addTo(o),that.parkingpts.addTo(o),_.addTo(o),addMouseClickListener(that.parkingpts)):window.location.href.indexOf("what2do")>-1?(e(["what2do","what2do-entertainment","what2do-recreation"]),that.what2doCategories=["370","376","432","334","372","141","142","373","374","144","219","446","221","448","431","449","222","451","450","447","355","220"],z.addTo(o),addMouseClickListener(z)):window.location.href.indexOf("retail")>-1?(e(["retail-293","retail","retail-276","retail-279","retail-284","retail-415","retail-286","retail-287","retail-288","retail-294"]),that.retailCategories=["276","415","286","287","288","337","294","279","293","284"],r.addTo(o),addMouseClickListener(r)):(G.addTo(o),P.addTo(o),E.addTo(o),B.addTo(o),_.addTo(o),I.addTo(o),addMouseClickListener(B),addMouseClickListener(G),addMouseClickListener(P),addMouseClickListener(_),addMouseClickListener(E),addMouseClickListener(I)),$(".select-item.parent .switch-label span").on("click",function(e){e.stopPropagation();var a=$(this).parent(".switch-label").parent(".select-item").parent("li"),o=a.hasClass("open");t(a,!o)});var Q=[];$("#search-select-list .select-item").each(function(){$(this).data("selected")&&Q.push($(this).data("value"))}),$("#search-select-list .select-item").on("click",function(e){if("checkbox"!==e.target.type){var t=$(this).data("value");const o=Q.indexOf(t)==-1;a($(this),t,o),$(this).siblings(".children").length>0&&$(this).siblings(".children").each(function(e){$(this).find(".select-item").each(function(e){a($(this),$(this).data("value"),o)})}),$(this).parents(".children").length>0&&$(this).parents(".children").each(function(e){var t=!0;$(this).find(".select-item").each(function(e){Q.indexOf($(this).data("value"))==-1&&(t=!1)}),t?$(this).siblings(".select-item").each(function(e){a($(this),$(this).data("value"),!0)}):$(this).siblings(".select-item").each(function(e){a($(this),$(this).data("value"),!1)})})}}),$("#search-select-bar").on("input",function(e){function a(e,t){e.each(function(e){$(this).hide(),$(this).children(".children").length>0&&a($(this).children(".children").children("li"),t),$(this).text().toLowerCase().indexOf(t.toLowerCase())>-1&&($(this).show(),r++)})}var o=$(this).val(),r=0;a($("#search-select-list").children("li:not(#no-results)"),o),$("#search-select-list").children("li:not(#no-results)").each(function(){t($(this),o.length>0)}),0===r?$("#no-results").show().find(".switch-label").html('<span class="icon glyphicon glyphicon-remove"></span>&nbsp;&nbsp;No results matched "'+o+'"'):$("#no-results").hide()});var H,R=new Date;H=R.toString("dddd, MMMM dd, yyyy h:mm tt"),$(".thumbnail").on("click",function(e){var t=this.id;N.eachLayer(function(e){e.feature.id==t&&layerpointclick(e)})});var Z=L.icon({iconUrl:"app/css/ripple.gif",iconAnchor:[10,10]}),D=L.Control.extend({options:{position:"bottomleft"},onAdd:function(e){var t=L.DomUtil.create("div","privacy-control");return t.innerHTML='<a href="https://visitsedona.com/privacy-policy/" target="_blank">Privacy Policy</a>',t}});o.addControl(new D),R.getHours()>19||R.getHours()<7?L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Earth:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:22}),"Sedona Red":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Dark:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin961o3z00epcxnhaxgzwdb6/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(o)},null,{position:"bottomleft"}).addTo(o):L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Earth:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:22}),"Sedona Red":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(o)},null,{position:"bottomleft"}).addTo(o);var W=L.control.locate({follow:!0,keepCurrentZoomLevel:!1,locateOptions:{maxZoom:16},metric:!1,showPopup:!0,position:"topright",markerClass:L.marker,markerStyle:{icon:Z},strings:{title:"Show me where I am and what is closest to me!"},onLocationError:function(e){vex.dialog.buttons.YES.text="OK";var t="";bowser.msie?t="<a target='_blank' style='color:#7A1800' href='http://windows.microsoft.com/en-us/internet-explorer/ie-security-privacy-settings#ie=ie-11'>How To </a>":bowser.chrome?t="<a target='_blank' style='color:#7A1800' href='https://support.google.com/chrome/answer/142065?hl=en'>How To </a>":bowser.firefox?t="<a target='_blank' style='color:#7A1800' href='https://support.mozilla.org/en-US/kb/improve-mozilla-location-services-turning-location'>How To </a>":bowser.android?t="<a target='_blank' style='color:#7A1800' href='https://support.scruff.com/hc/en-us/articles/202623634-How-do-I-enable-location-services-on-my-Android-'>How To </a>":bowser.ios&&(t="<a target='_blank' style='color:#7A1800' href='https://support.apple.com/en-us/HT203033'>How To </a>"),vex.dialog.alert({message:"Please Enable Your Location to find best directions from where you are.<br><br>"+t}),that.loader.className="hide"}}).addTo(o);o.addControl(L.control.customsearch({position:"topright"})),that.loader.className="hide",o.on("locationfound",function(e){({type:"Feature",properties:{"marker-color":"#f00","marker-size":"small"},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}});if(0==that.gotoloc.length)if(jQuery.isEmptyObject(that.points._layers))vex.dialog.buttons.YES.text="OK",vex.dialog.alert({message:"Please Turn Layers on to Find Closest Location."});else{var t=L.GeometryUtil.closestLayer(that.map,that.points,e.latlng);bowser.android||bowser.ios||that.points.eachLayer(function(e){e.feature.properties.title===t.layer.feature.properties.title&&e.openPopup()}),e.accuracy>550?(that.map.setView(e.latlng,14),vex.dialog.buttons.YES.text="OK",vex.dialog.alert({message:"Your computer says you are over "+Number(e.accuracy/3.28084).toFixed(0)+" feet from here<br><br><br><b>Please enable wifi or use your phone to locate you."})):(that.map.setView(e.latlng,16),vex.dialog.buttons.YES.text="Get Directions",vex.dialog.alert({message:"You are within "+Number(e.accuracy/3.28084).toFixed(0)+" feet here!<br><br><i>"+t.layer.feature.properties.title+"</i> is closest to you.<br>",callback:function(a){if(1==a){var o=[t.layer.feature.geometry.coordinates[1],t.layer.feature.geometry.coordinates[0]];that.loader.className="",that.getdirections(e.latlng,o)}}}))}else"[object Array]"===Object.prototype.toString.call(that.gotoloc[0])?that.getdirections(e.latlng,that.gotoloc[0]):that.getdirections(e.latlng,that.gotoloc);that.map.stopLocate()});var A=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){var t=L.DomUtil.create("div","img-control");return t}});o.addControl(new A),$(".img-control").click(function(){window.open("http://visitsedona.com/","_blank")}),vex.dialog.buttons.YES.text="Start Here",vex.dialog.buttons.NO.text="Browse Map",H="Walk Sedona shows Sedona Attractions and potential walkable locations.<br><br>Press 'Start Here' to find closest location.<br><br>Use the drop down list <span class='caret'></span> at the <b>top</b> of the page to search more categories.<br><br>Use the <span class='fa fa-map-marker'></span> to the <b>left</b> to find yourself on the map.",H+="<br><br><i>Check Location Website for up-to-date hours of operations.</i>",vex.dialog.confirm({message:"<br><a target='_blank' href='http://visitsedona.com/'><img src='assets/big_sedona.png' style='padding-left:70px;padding-bottom:5px !important;padding-right:32px !important;'></></a><br><br>"+H,callback:function(e){1==e&&W.start()}})}function layerpointclick(e){e.openPopup(),map.setView(e._latlng,15),map.panBy([0,-130]),"Point"==e.feature.geometry.type&&(that.gotoloc=[e.feature.geometry.coordinates[1],e.feature.geometry.coordinates[0]]),$("#direc").on("click",function(e){e.preventDefault(),that.loader.className="",that.map.stopLocate(),that.map.locate()})}function processLayerGeo(e){that.points.addData(e.target.getGeoJSON())}function processLayer2Geo(e){that.points.addData(e.getGeoJSON())}function addParkinglotInfo(e){var t="https://walksedona.com/php/proxy_parkinglot.php?https://api.streetsoncloud.com/pl1/multi-lot-info";$.get({url:t,success:function(t){that.total_spaces=t[0][0].total_spaces,that.free_spaces=t[0][0].free_spaces,that.occupancy_per=t[0][0].occupancy+"%",that.map.eachLayer(function(t){if(t.options&&t.options.hasOwnProperty("popupOptions")&&"parking"==t.options.popupOptions.settings)for(var a in that.parkingpts._layers)"marker-in81c3mc7"==that.parkingpts._layers[a].feature.properties.id&&(that.parkingpts._layers[a]._icon.title="Lot #5 ("+that.free_spaces+") spaces available",that.parkingpts._layers[a].setPopupContent('<div style="color:#4bc1b9;width:162px;"><b>Lot #5 ('+that.free_spaces+') spaces currently available</b><div class="marker-description"><img style="padding-top:3px;" src="https://walksedona.com/assets/parkinglots/p5map.png"><br>@Cedar and Schnebly<br><div id="direc"><a target="_blank">Get Directions!</a></div></div>'),e&&that.parkingpts._layers[a].openPopup(),that.gotoloc=[34.87280792707314,-111.76021456718445],$("#direc").on("click",function(e){e.preventDefault(),that.loader.className="",that.map.stopLocate(),that.map.locate()}))})},error:function(e,t,a){vex.dialog.buttons.YES.text="OK",vex.dialog.alert({message:"There was an error collecting real time parking information.  Please try back later."}),that.loader.className="hide"}})}function addRealTimeParking(e){var t="https://walksedona.com/php/proxy.php?http://spaceoccupancy.duncan-usa.com/sensor/status/latest/get/json/customer/4211/area/100";addParkinglotInfo(e),setTimeout(function(){$.get({url:t,success:function(e){var e=JSON.parse(e),t=e.i_areas[0].indicators.glob_addr,a=e.i_areas[0].indicators.occupied;that.totalopen=0;for(var o in that.spacespts._layers)for(var r=a.length;r>=-1;r--)t[r]==that.spacespts._layers[o].feature.properties.Spaceid&&(a[r]?(that.spacespts._layers[o].feature.properties.id=o,that.spacespts._layers[o].feature.properties.title="Occupied",that.spacespts._layers[o].feature.properties.description="Occupied",that.spacespts._layers[o].bindPopup("Space Occupied"),that.spacespts._layers[o].options.icon.options.iconUrl="https://a.tiles.mapbox.com/v4/marker/pin-m-roadblock+ff2828.png?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg"):(that.totalopen++,that.spacespts._layers[o].feature.properties.id=o,that.spacespts._layers[o].feature.properties.title="Open",that.spacespts._layers[o].feature.properties.description="Open",that.spacespts._layers[o].bindPopup("Space Available"),that.spacespts._layers[o].options.icon.options.iconUrl="https://a.tiles.mapbox.com/v4/marker/pin-m-car+00ac00.png?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg"));that.loader.className="hide",that.spacespts.addTo(map),that.totalopen=Number(that.free_spaces)+that.totalopen},error:function(e,t,a){vex.dialog.buttons.YES.text="OK",vex.dialog.alert({message:"There was an error collecting real time parking information.  Please try back later."}),that.loader.className="hide"}})},2300)}function addMouseClickListener(e){e.on("click",function(e){e.layer.openPopup(),"Point"==e.layer.feature.geometry.type&&(that.gotoloc=[e.layer.feature.geometry.coordinates[1],e.layer.feature.geometry.coordinates[0]]),$("#direc").on("click",function(e){e.preventDefault(),that.loader.className="",that.map.stopLocate(),that.map.locate()}),that.layertitle=e.layer.feature.properties.title,that.id2send=e.layer.feature.properties.title,$("#linksite").on("click",function(e){ga("send","event","linksite","click",that.layertitle);var t=(new Date).toJSON(),a=t.split("T")[0];({action:"updateHits",username:"SedonaMaps_API",password:"cart0gr@phick!",hittypeid:"4",recid:that.id2send,hitdate:a});$.ajax({url:"https://walksedona.com/php/updatehit.php?idval="+that.id2send+"&d="+a,success:function(e){},error:function(e,t,a){}})}),ga("send","event","marker","click",e.layer.feature.properties.title)})}function getdirections(e,t){that=this,that.directionlayer&&that.map.removeLayer(that.directionlayer),that.to&&that.map.removeLayer(that.to),that.from&&that.map.removeLayer(that.from),that.to=L.circle(t,26,{color:"#fff",fillColor:"#9E2C2E",fillOpacity:.7}).addTo(map),that.from=L.circle(e,26,{color:"#fff",fillColor:"#A1D490",fillOpacity:.7}).addTo(map).bindPopup("You are here.").bringToFront();var a="https://api.mapbox.com/directions/v5/mapbox/driving-traffic/"+e.lng+","+e.lat+";"+t[1]+","+t[0]+"?alternatives=true&geometries=geojson&steps=true&access_token="+that.token;$.get(a,function(e){if(e.routes.length>0){var t={};t.geometry=e.routes[0].geometry,t.type="Feature",t.properties={};var a="<i>Drive Time (w/ Traffic)<br>"+Number(e.routes[0].duration/60).toFixed(0)+" minutes<br><br>Distance: "+Number(621371e-9*e.routes[0].distance).toFixed(0)+" miles",o={color:"#61C5BE",weight:5,dashArray:"5,10",opacity:.9};that.directionlayer=L.geoJson(t,o).bindPopup(a).addTo(that.map);var r=that.directionlayer.getBounds();bowser.android||bowser.ios?(that.map.fitBounds(r,{padding:[73,73]}),that.directionlayer.eachLayer(function(e){e.openPopup()})):(that.map.fitBounds(r,{padding:[15,15]}),that.directionlayer.eachLayer(function(e){e.openPopup()}))}else vex.dialog.alert({message:"No Current Directions, please try again."});that.gotoloc=[],that.loader.className="hide"})}function toggleNav(){$("#side-menu").toggleClass("is-active"),$("#hamburger").toggleClass("is-active"),$("#main").toggleClass("is-active")}