function startup(){that=this,that.token="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",L.mapbox.accessToken="pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg";var t=L.mapbox.map("map").setView([34.86394,-111.76486],14).addControl(L.mapbox.shareControl()).addControl(L.mapbox.geocoderControl("mapbox.places"));that.map=t,that.gotoloc="";var e=L.mapbox.featureLayer("sedonachamber.pmj9fija").addTo(t);e.on("mouseover",function(t){t.layer.openPopup(),that.gotoloc=[t.layer.feature.geometry.coordinates[1],t.layer.feature.geometry.coordinates[0]],$("#direc").click(function(t){t.preventDefault(),that.map.locate()})});var o=L.control.locate({follow:!0,keepCurrentZoomLevel:!1,locateOptions:{maxZoom:16},metric:!1,showPopup:!0,onLocationError:function(t){alert(t.message)}}).addTo(t);L.control.layers({Streets:L.mapbox.tileLayer("mapbox.streets",{maxZoom:20}),Imagery:L.mapbox.tileLayer("mapbox.satellite",{maxZoom:20}),"Simple Streets":L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2opt8d00b9abnq6trki27e/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),'Outside<img src="http://sedona.simpleviewcrm.com/images//listings/celeste-800x600.jpg" height="160" width="160">':L.mapbox.tileLayer("mapbox.run-bike-hike"),Sedona:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin7oyyjz000waamcx7v412nr/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}),Red:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin2kt8ku001sb4mawvdvwjxf/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20}).addTo(t),Light:L.mapbox.tileLayer("mapbox.light"),Dark:L.tileLayer("https://api.mapbox.com/styles/v1/sedonachamber/cin961o3z00epcxnhaxgzwdb6/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2Vkb25hY2hhbWJlciIsImEiOiJjaW13Zmp3cGswMzd0d2tsdXBnYmVjNmRjIn0.PlcjviLrxQht-_tBEbQQeg",{maxZoom:20})},{}).addTo(t),t.on("locationfound",function(o){var a={type:"Feature",properties:{"marker-color":"#f00","marker-size":"small"},geometry:{type:"Point",coordinates:[o.longitude,o.latitude]}};if(that.currentloc=a,""==that.gotoloc){for(var r=e.getGeoJSON(),i=0;i<r.features.length;i++)"Point"!=r.features[i].geometry.type&&r.features.splice(i,1);var n=turf.nearest(a,r);e.eachLayer(function(t){t.feature.properties.title===n.properties.title&&t.openPopup()}),vex.dialog.buttons.YES.text="Get Directions",vex.dialog.alert({message:"You are here!<br><br><i>"+n.properties.title+"</i> is the closest to you.<br>",callback:function(t){var e=[n.geometry.coordinates[1],n.geometry.coordinates[0]];that.getdirections(o.latlng,e)}})}else that.getdirections(o.latlng,that.gotoloc);t.stopLocate()});var a=L.Control.extend({options:{position:"bottomright"},onAdd:function(t){var e=L.DomUtil.create("div","img-control");return e}});t.addControl(new a),$(".img-control").click(function(){window.open("http://visitsedona.com/","_blank")}),vex.dialog.buttons.YES.text="Start Here",vex.dialog.buttons.NO.text="Browse Map";var r,i=new Date;r=i.toString("dddd, MMMM dd, yyyy h:mm tt"),5==i.getDay()&&i.getDate()<7?r+='<br><br><a target="_blank" style="color:#7A1800" href="http://sedonagalleryassociation.com/?page_id=236">First Friday Art Walk. Click here for more information.</a></i>':4==i.getDay()&&i.getDate()<7?r+='<br><br><a target="_blank" style="color:#7A1800" href="http://sedonagalleryassociation.com/?page_id=236">First Friday Art Walk is tomorrow. Click here for more information.</a></i>':(i.getHours()>18||i.getHours()<8)&&(r+="<br><br><i>Galleries may be closed in the evening.</i>"),vex.dialog.confirm({message:"Welcome to the Sedona ArtWalk Map!<br><br><img src='assets/red_sedona.jpg' style='margin-left: 29%'></><br><br>"+r,callback:function(t){1==t&&o.start()}})}function getdirections(t,e){that=this,that.directionlayer&&that.map.removeLayer(that.directionlayer),that.to&&that.map.removeLayer(that.to),that.from&&that.map.removeLayer(that.from),that.to=L.circle(e,25,{color:"#fff",fillColor:"#9E2C2E",fillOpacity:.7}).addTo(map),that.from=L.circle(t,25,{color:"#fff",fillColor:"#A1D490",fillOpacity:.7}).addTo(map).bringToFront();var o="https://api.tiles.mapbox.com/v4/directions/mapbox.cycling/"+t.lng+","+t.lat+";"+e[1]+","+e[0]+".json?instructions=json&geometry=line&access_token="+that.token;$.get(o,function(t){if(t.routes.length>0){var e={};e.geometry=t.routes[0].geometry,e.type="Feature",e.properties={};var o="<i>Walking Time: "+Number(t.routes[0].duration/19).toPrecision(2)+" minutes<br><br>Walking Distance: "+Number(621371e-9*t.routes[0].distance).toPrecision(2)+" miles",a={color:"#61C5BE",weight:5,opacity:.9};that.directionlayer=L.geoJson(e,a).bindPopup(o).addTo(that.map),that.directionlayer.eachLayer(function(t){t.openPopup()})}else alert("No Current Directions, please try again");that.gotoloc=""})}